#!/usr/bin/env python3
# wg_qr_generator/settings.py
# ===========================================
# –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ø—Ä–æ–µ–∫—Ç–∞ wg_qr_generator
# ===========================================
# –≠—Ç–æ—Ç —Ñ–∞–π–ª —Å–æ–¥–µ—Ä–∂–∏—Ç –æ—Å–Ω–æ–≤–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ø—Ä–æ–µ–∫—Ç–∞, –≤–∫–ª—é—á–∞—è –ø—É—Ç–∏ –∫ —Ñ–∞–π–ª–∞–º,
# –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è–º, –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è–º, –∞ —Ç–∞–∫–∂–µ –≥–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã.
# –û–Ω —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑—É–µ—Ç –≤—Å–µ –≤–∞–∂–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–ª—è —É–ø—Ä–æ—â–µ–Ω–∏—è –ø–æ–¥–¥–µ—Ä–∂–∫–∏ –ø—Ä–æ–µ–∫—Ç–∞.
#
# –ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è:
# ---------------------
# from settings import BASE_DIR, WG_CONFIG_DIR, GRADIO_PORT
# 
# print(f"–ö–æ—Ä–Ω–µ–≤–∞—è –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è –ø—Ä–æ–µ–∫—Ç–∞: {BASE_DIR}")
# print(f"–î–∏—Ä–µ–∫—Ç–æ—Ä–∏—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–π WireGuard: {WG_CONFIG_DIR}")
# print(f"–ü–æ—Ä—Ç –¥–ª—è –∑–∞–ø—É—Å–∫–∞ Gradio: {GRADIO_PORT}")
#
# –í–ê–ñ–ù–û: –í—Å–µ –ø—É—Ç–∏ –∏ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã —Å–ª–µ–¥—É–µ—Ç —É–∫–∞–∑—ã–≤–∞—Ç—å –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ BASE_DIR.
# ===========================================
# –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ:
# –î–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ–º –≤ –ø—Ä–æ–µ–∫—Ç–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –º–æ–¥—É–ª—å logging.
# –í—ã –º–æ–∂–µ—Ç–µ –∏–∑–º–µ–Ω–∏—Ç—å —É—Ä–æ–≤–µ–Ω—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è —á–µ—Ä–µ–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é LOG_LEVEL:
# - DEBUG: –í—ã–≤–æ–¥ –≤—Å–µ—Ö —Å–æ–æ–±—â–µ–Ω–∏–π, –≤–∫–ª—é—á–∞—è –æ—Ç–ª–∞–¥–æ—á–Ω—ã–µ.
# - INFO: –û—Å–Ω–æ–≤–Ω—ã–µ –¥–µ–π—Å—Ç–≤–∏—è –±–µ–∑ –æ—Ç–ª–∞–¥–æ—á–Ω—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π.
# - WARNING: –¢–æ–ª—å–∫–æ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è –∏ –æ—à–∏–±–∫–∏.
# - ERROR: –¢–æ–ª—å–∫–æ –æ—à–∏–±–∫–∏.
# –õ–æ–≥–∏ –∑–∞–ø–∏—Å—ã–≤–∞—é—Ç—Å—è –∫–∞–∫ –≤ –∫–æ–Ω—Å–æ–ª—å, —Ç–∞–∫ –∏ –≤ —Ñ–∞–π–ª, –ø—É—Ç—å –∫ –∫–æ—Ç–æ—Ä–æ–º—É —É–∫–∞–∑–∞–Ω –≤ LOG_FILE_PATH.
#
# –í–µ—Ä—Å–∏—è: 1.5 (2024-12-02) 18:30

from pathlib import Path
import os
import configparser

# –û–ø—Ä–µ–¥–µ–ª—è–µ–º –±–∞–∑–æ–≤—ã–π –ø—É—Ç—å –∫ –∫–æ—Ä–Ω—é –ø—Ä–æ–µ–∫—Ç–∞
BASE_DIR = Path(__file__).resolve().parent  # –ü—É—Ç—å –∫ –∫–æ—Ä–Ω–µ–≤–æ–π –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ wg_qr_generator
PROJECT_DIR = BASE_DIR  # –î–ª—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏, PROJECT_DIR —Ä–∞–≤–µ–Ω BASE_DIR

# –ü—É—Ç–∏ –∫ —Ñ–∞–π–ª–∞–º –∏ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è–º
WG_CONFIG_DIR = BASE_DIR / "user/data/wg_configs"  # –ü—É—Ç—å –∫ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è–º WireGuard –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
QR_CODE_DIR = BASE_DIR / "user/data/qrcodes"      # –ü—É—Ç—å –∫ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–º QR-–∫–æ–¥–∞–º
STALE_CONFIG_DIR = BASE_DIR / "user/data/usr_stale_config"  # –ü—É—Ç—å –∫ —É—Å—Ç–∞—Ä–µ–≤—à–∏–º –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
USER_DB_PATH = BASE_DIR / "user/data/user_records.json"  # –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
#IP_DB_PATH = BASE_DIR / "user/data/ip_records.json"      # –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö IP-–∞–¥—Ä–µ—Å–æ–≤
SERVER_CONFIG_FILE = Path("/etc/wireguard/wg0.conf")     # –ü—É—Ç—å –∫ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω–æ–º—É —Ñ–∞–π–ª—É —Å–µ—Ä–≤–µ—Ä–∞ WireGuard
SERVER_BACKUP_CONFIG_FILE = Path("/etc/wireguard/wg0.conf.bak") # –ü—É—Ç—å –∫ backup –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω–æ–º—É —Ñ–∞–π–ª—É —Å–µ—Ä–≤–µ—Ä–∞ WireGuard
PARAMS_FILE = Path("/etc/wireguard/params")             # –ü—É—Ç—å –∫ —Ñ–∞–π–ª—É –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ WireGuard

# –ü–∞—Ä–∞–º–µ—Ç—Ä—ã WireGuard
DEFAULT_TRIAL_DAYS = 30  # –ë–∞–∑–æ–≤—ã–π —Å—Ä–æ–∫ –¥–µ–π—Å—Ç–≤–∏—è –∞–∫–∫–∞—É–Ω—Ç–∞ –≤ –¥–Ω—è—Ö
WIREGUARD_PORT = 51820   # –ü–æ—Ä—Ç –¥–ª—è —Å–µ—Ä–≤–µ—Ä–∞ WireGuard (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é) range [1-65535]
DEFAULT_SUBNET = "10.66.66.0/24"
USER_SET_SUBNET = DEFAULT_SUBNET
DNS_WIREGUAED = "1.1.1.1, 1.0.0.1, 8.8.8.8"

# –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –¥–ª—è –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
LOG_DIR = BASE_DIR / "user/data/logs"  # –î–∏—Ä–µ–∫—Ç–æ—Ä–∏—è –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –ª–æ–≥–æ–≤
DIAGNOSTICS_LOG = LOG_DIR / "diagnostics.log"  # –§–∞–π–ª –ª–æ–≥–æ–≤ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏
SUMMARY_REPORT_PATH = LOG_DIR / "summary_report.txt"  # –§–∞–π–ª –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –æ–±–æ–±—â–µ–Ω–Ω–æ–≥–æ –æ—Ç—á–µ—Ç–∞
LOG_FILE_PATH = LOG_DIR / "app.log"  # –§–∞–π–ª –¥–ª—è –∑–∞–ø–∏—Å–∏ –ª–æ–≥–æ–≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
LOG_LEVEL = "DEBUG"  # –£—Ä–æ–≤–µ–Ω—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è: DEBUG, INFO, WARNING, ERROR

# –ü—É—Ç–∏ –∫ –æ—Ç—á–µ—Ç–∞–º –∏ –±–∞–∑–µ —Å–æ–æ–±—â–µ–Ω–∏–π
DEBUG_REPORT_PATH = BASE_DIR / "ai_diagnostics/debug_report.txt"  # –ü—É—Ç—å –∫ –æ—Ç—á–µ—Ç—É –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏
TEST_REPORT_PATH = BASE_DIR / "ai_diagnostics/test_report.txt"    # –ü—É—Ç—å –∫ –æ—Ç—á–µ—Ç—É —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
MESSAGES_DB_PATH = BASE_DIR / "ai_diagnostics/messages_db.json"   # –ü—É—Ç—å –∫ –±–∞–∑–µ —Å–æ–æ–±—â–µ–Ω–∏–π –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏

# –ü—É—Ç–∏ –∫ —Å–ø—Ä–∞–≤–∫–µ
HELP_JSON_PATH = BASE_DIR / "ai_diagnostics/ai_help/ai_help.json"  # –ù–æ–≤—ã–π –ø—É—Ç—å –¥–ª—è —Å–ø—Ä–∞–≤–æ—á–Ω–æ–π —Å–∏—Å—Ç–µ–º—ã

# –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø—É—Ç–∏ –¥–ª—è –º–æ–¥—É–ª–µ–π –∏ —É—Ç–∏–ª–∏—Ç
MODULES_DIR = BASE_DIR / "modules"            # –î–∏—Ä–µ–∫—Ç–æ—Ä–∏—è —Å –º–æ–¥—É–ª—è–º–∏
AI_DIAGNOSTICS_DIR = BASE_DIR / "ai_diagnostics"  # –î–∏—Ä–µ–∫—Ç–æ—Ä–∏—è —Å —Ñ–∞–π–ª–∞–º–∏ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏

# –ü–æ—Ä—Ç –¥–ª—è Gradio
GRADIO_PORT = 7860  # –ü–æ—Ä—Ç –¥–ª—è –∑–∞–ø—É—Å–∫–∞ Gradio –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞

# LLM_API_URL
LLM_API_URL = "http://10.67.67.2:11434/api/generate"


# –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–∫–æ—Ä–æ—Å—Ç–∏ –¥–ª—è –∞–Ω–∏–º–∞—Ü–∏–∏ –∏ –∏–º–∏—Ç–∞—Ü–∏–∏ –ø–µ—á–∞—Ç–∏
ANIMATION_SPEED = 0.2  # –ó–∞–¥–µ—Ä–∂–∫–∞ –º–µ–∂–¥—É –∏—Ç–µ—Ä–∞—Ü–∏—è–º–∏ –∞–Ω–∏–º–∞—Ü–∏–∏ (–≤ —Å–µ–∫—É–Ω–¥–∞—Ö)
# –ü—Ä–∏–º–µ—Ä—ã –∑–Ω–∞—á–µ–Ω–∏–π:
# - 0.1: –£—Å–∫–æ—Ä–µ–Ω–Ω–∞—è –∞–Ω–∏–º–∞—Ü–∏—è, –ø–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è –∫–æ—Ä–æ—Ç–∫–∏—Ö —Å–æ–æ–±—â–µ–Ω–∏–π.
# - 0.2 (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é): –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∞—è —Å–∫–æ—Ä–æ—Å—Ç—å, –ø–ª–∞–≤–Ω–∞—è –∞–Ω–∏–º–∞—Ü–∏—è –¥–ª—è –∫–æ–º—Ñ–æ—Ä—Ç–Ω–æ–≥–æ –≤–æ—Å–ø—Ä–∏—è—Ç–∏—è.
# - 0.3: –ù–µ–º–Ω–æ–≥–æ –º–µ–¥–ª–µ–Ω–Ω–µ–µ, –µ—â—ë –±–æ–ª–µ–µ –ø–ª–∞–≤–Ω—ã–π —ç—Ñ—Ñ–µ–∫—Ç.
# - 0.5: –ú–µ–¥–ª–µ–Ω–Ω–∞—è –∞–Ω–∏–º–∞—Ü–∏—è, –ø–æ–¥—á—ë—Ä–∫–∏–≤–∞–µ—Ç –≤–∞–∂–Ω–æ—Å—Ç—å –∏–ª–∏ –∞–∫—Ü–µ–Ω—Ç–∏—Ä—É–µ—Ç –≤–Ω–∏–º–∞–Ω–∏–µ.


PRINT_SPEED = 0.02  # –°–∫–æ—Ä–æ—Å—Ç—å –≤—ã–≤–æ–¥–∞ —Å–∏–º–≤–æ–ª–æ–≤ (–≤ —Å–µ–∫—É–Ω–¥–∞—Ö)
# –ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è:
# - 0.02 (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é): –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∞—è —Å–∫–æ—Ä–æ—Å—Ç—å, –Ω–∞–ø–æ–º–∏–Ω–∞—é—â–∞—è —Ä—É—á–Ω–æ–π –≤–≤–æ–¥ —Ç–µ–∫—Å—Ç–∞.
# - 0.01: –ë—ã—Å—Ç—Ä–∞—è –ø–µ—á–∞—Ç—å, –ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏ –º–≥–Ω–æ–≤–µ–Ω–Ω–∞—è.
# - 0.05: –ú–µ–¥–ª–µ–Ω–Ω–∞—è –ø–µ—á–∞—Ç—å, —Å–æ–∑–¥–∞—ë—Ç —ç—Ñ—Ñ–µ–∫—Ç –≤–¥—É–º—á–∏–≤–æ–≥–æ —Ç–µ–∫—Å—Ç–∞.

LINE_DELAY = 0.1  # –ó–∞–¥–µ—Ä–∂–∫–∞ –º–µ–∂–¥—É —Å—Ç—Ä–æ–∫–∞–º–∏ (–≤ —Å–µ–∫—É–Ω–¥–∞—Ö)
# –ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è:
# - 0.1 (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é): –ü–ª–∞–≤–Ω—ã–π –ø–µ—Ä–µ—Ö–æ–¥ –º–µ–∂–¥—É —Å—Ç—Ä–æ–∫–∞–º–∏.
# - 0.05: –ë—ã—Å—Ç—Ä—ã–π –ø–µ—Ä–µ—Ö–æ–¥ –º–µ–∂–¥—É —Å—Ç—Ä–æ–∫–∞–º–∏, –¥–ª—è —Å–æ–∫—Ä–∞—â–µ–Ω–∏—è –≤—Ä–µ–º–µ–Ω–∏ –≤—ã–≤–æ–¥–∞.
# - 0.2: –ú–µ–¥–ª–µ–Ω–Ω—ã–π –ø–µ—Ä–µ—Ö–æ–¥, –∞–∫—Ü–µ–Ω—Ç–∏—Ä—É–µ—Ç –≤–Ω–∏–º–∞–Ω–∏–µ –Ω–∞ –Ω–æ–≤–æ–π —Å—Ç—Ä–æ–∫–µ.

# –§—É–Ω–∫—Ü–∏—è –¥–ª—è —á—Ç–µ–Ω–∏—è SERVER_WG_NIC –∏–∑ —Ñ–∞–π–ª–∞ params
def get_server_wg_nic(params_file):
    """
    –ò–∑–≤–ª–µ–∫–∞–µ—Ç –∑–Ω–∞—á–µ–Ω–∏–µ SERVER_WG_NIC –∏–∑ —Ñ–∞–π–ª–∞ params.
    :param params_file: –ü—É—Ç—å –∫ —Ñ–∞–π–ª—É params
    :return: –ó–Ω–∞—á–µ–Ω–∏–µ SERVER_WG_NIC
    """
    if not os.path.exists(params_file):
        raise FileNotFoundError(f"–§–∞–π–ª {params_file} –Ω–µ –Ω–∞–π–¥–µ–Ω.")

    with open(params_file, "r") as f:
        for line in f:
            if line.startswith("SERVER_WG_NIC="):
                # –ò–∑–≤–ª–µ–∫–∞–µ–º –∑–Ω–∞—á–µ–Ω–∏–µ –ø–æ—Å–ª–µ "=" –∏ —É–¥–∞–ª—è–µ–º –ø—Ä–æ–±–µ–ª—ã
                return line.split("=")[1].strip()
    raise ValueError("SERVER_WG_NIC –Ω–µ –Ω–∞–π–¥–µ–Ω –≤ —Ñ–∞–π–ª–µ params.")

# –û–ø—Ä–µ–¥–µ–ª—è–µ–º SERVER_WG_NIC
try:
    SERVER_WG_NIC = get_server_wg_nic(PARAMS_FILE)
except (FileNotFoundError, ValueError) as e:
    SERVER_WG_NIC = None
    print(f"‚ö†Ô∏è –ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å SERVER_WG_NIC: {e}")

def check_paths():
    """–ü—Ä–æ–≤–µ—Ä—è–µ—Ç —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏–µ —Ñ–∞–π–ª–æ–≤ –∏ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–π."""
    paths = {
        "BASE_DIR": BASE_DIR,
        "PROJECT_DIR": PROJECT_DIR,
        "WG_CONFIG_DIR": WG_CONFIG_DIR,
        "QR_CODE_DIR": QR_CODE_DIR,
        "USER_DB_PATH": USER_DB_PATH,
        #"IP_DB_PATH": IP_DB_PATH,
        "SERVER_CONFIG_FILE": SERVER_CONFIG_FILE,
        "PARAMS_FILE": PARAMS_FILE,
        "LOG_DIR": LOG_DIR,
        "DIAGNOSTICS_LOG": DIAGNOSTICS_LOG,
        "SUMMARY_REPORT_PATH": SUMMARY_REPORT_PATH,
        "DEBUG_REPORT_PATH": DEBUG_REPORT_PATH,
        "TEST_REPORT_PATH": TEST_REPORT_PATH,
        "MESSAGES_DB_PATH": MESSAGES_DB_PATH,
        "HELP_JSON_PATH": HELP_JSON_PATH,
        "MODULES_DIR": MODULES_DIR,
        "AI_DIAGNOSTICS_DIR": AI_DIAGNOSTICS_DIR,
    }
    status = []
    for name, path in paths.items():
        exists = " ‚úÖ  –î–æ—Å—Ç—É–ø–µ–Ω" if path.exists() else " ‚ùå  –û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç"
        status.append(f"{name}: {exists} ({path})")
    return "\n".join(status)


if __name__ == "__main__":
    print(f"\n === üõ†Ô∏è  –°–æ—Å—Ç–æ—è–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞ wg_qr_generator  ===\n")
    print(f"  –ö–æ—Ä–Ω–µ–≤–∞—è –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è –ø—Ä–æ–µ–∫—Ç–∞: {BASE_DIR}")
    print(f"  –ü–æ—Ä—Ç –¥–ª—è –∑–∞–ø—É—Å–∫–∞ Gradio: {GRADIO_PORT}")
    print(f"  –ü–æ—Ä—Ç WireGuard: {WIREGUARD_PORT}\n")
    print(f" === üìÇ  –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ñ–∞–π–ª–æ–≤ –∏ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–π  ===\n")
    print(check_paths())
    print(f"\n")
